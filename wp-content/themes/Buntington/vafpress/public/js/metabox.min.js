(function(e){"use strict";function s(s){s.each(function(){if(e(this).parents(".tocopy").length<=0){vp.init_controls(e(this));var s=e(this).attr("id"),o=e(this).attr("id"),u=e(this).attr("data-vp-validation"),a=e(this).attr("data-vp-bind"),f=e(this).attr("data-vp-items-bind"),l=e(this).attr("data-vp-dependency"),c=e(this).getDatas().type;u&&t.push({name:s,rules:u,type:c});if(typeof a!=="undefined"&&a!==false){a&&n.push({bind:a,type:c,source:s})}if(typeof f!=="undefined"&&f!==false){f&&r.push({bind:f,type:c,source:s})}if(typeof l!=="undefined"&&l!==false){l&&i.push({dep:l,type:"field",source:s})}}})}function o(t){t.each(function(){if(e(this).parents(".tocopy").length<=0&&!e(this).hasClass(".tocopy")){var t=e(this).attr("data-vp-dependency"),n=e(this).getDatas().type,r=e(this).attr("id");if(typeof t!=="undefined"&&t!==false){t&&i.push({dep:t,type:"section",source:r})}}})}function u(){var t=[];e(".wpa_loop.vp-sortable").sortable({items:">.wpa_group",handle:".vp-wpa-group-heading",axis:"y",opacity:.5,tolerance:"pointer",start:function(n,r){if(typeof window.KIA_metabox!=="undefined"){t=[];vp.tinyMCE_save();e(r.item).find(".customEditor textarea").each(function(){if(e(this).parents(".tocopy").length<=0){try{tinyMCE.execCommand("mceRemoveControl",false,this.id)}catch(n){}t.push(vp.jqid(this.id))}})}},stop:function(n,r){if(typeof window.KIA_metabox!=="undefined"){for(var i=t.length-1;i>=0;i--){var s=e(t[i]);s.val(switchEditors.wpautop(s.val()))}t=t.join(", ");try{KIA_metabox.runTinyMCE(e(t));vp.tinyMCE_save();for(var i=t.length-1;i>=0;i--){var s=e(t[i]);s.val(switchEditors.pre_wpautop(s.val()))}}catch(o){}}}})}function a(e){for(var t=0;t<e.length;t++){var n=e[t];var r=n.bind.split("|");var i=r[0];var s=r[1];var o=[];var u="";u=n.source.replace("[]","");u=u.substring(0,u.lastIndexOf("["));s=s.split(/[\s,]+/);for(var a=0;a<s.length;a++){s[a]=u+"["+s[a]+"]";o.push(s[a])}for(a=0;a<o.length;a++){vp.binding_event(o,a,n,i,".vp-metabox","metabox")}}}function f(e){for(var t=0;t<e.length;t++){var n=e[t];var r=n.bind.split("|");var i=r[0];var s=r[1];var o=[];var u="";u=n.source.replace("[]","");u=u.substring(0,u.lastIndexOf("["));s=s.split(/[\s,]+/);for(var a=0;a<s.length;a++){s[a]=u+"["+s[a]+"]";o.push(s[a])}for(a=0;a<o.length;a++){vp.items_binding_event(o,a,n,i,".vp-metabox","metabox")}}}function l(e){for(var t=0;t<e.length;t++){var n=e[t];var r=n.dep.split("|");var i=r[0];var s=r[1];var o=[];var u="";if(n.type==="field"){u=n.source.replace("[]","");u=u.substring(0,u.lastIndexOf("["))}else if(n.type==="section"){var a=jQuery(vp.jqid(n.source));if(a.parents(".wpa_group").length>0){u=jQuery(vp.jqid(n.source)).parents(".wpa_group").first().attr("id")}else{u=jQuery(vp.jqid(n.source)).parents(".postbox").attr("id");u=u.substring(0,u.lastIndexOf("_"))}}s=s.split(",");for(var f=0;f<s.length;f++){s[f]=u+"["+s[f]+"]";o.push(s[f])}for(f=0;f<o.length;f++){vp.dependency_event(o,f,n,i,".vp-metabox")}}}var t=[];var n=[];var r=[];var i=[];e(document).on("click",".vp-wpa-group-title",function(t){t.preventDefault();var n=e(this).parents(".wpa_group:first");var r=n.find(".vp-controls:first");var i=n.siblings(".wpa_group:not(.tocopy)");var s=e("html, body");if(r.hasClass("vp-hide")){s.animate({scrollTop:n.offset().top-e("#wpadminbar").height()}).promise().done(function(){r.slideUp(0,function(){e(this).removeClass("vp-hide").slideDown("fast")})})}else{r.slideUp("fast",function(){e(this).addClass("vp-hide").slideDown(0)})}return false});e(document).ready(function(){s(jQuery(".vp-metabox .vp-field"));o(jQuery(".vp-metabox .vp-meta-group"));a(n);f(r);l(i);u()});vp.is_multianswer=function(e){var t=["vp-checkbox","vp-checkimage","vp-multiselect"];if(jQuery.inArray(e,t)!==-1){return true}return false};vp.custom_check_radio_event(".vp-metabox",".vp-field.vp-checkimage .field .input label");vp.custom_check_radio_event(".vp-metabox",".vp-field.vp-radioimage .field .input label");e("#post").on("submit",function(n){var r=e("input[type=submit][clicked=true]"),i=r.val(),s=0;vp.tinyMCE_save();e(".vp-field").removeClass("vp-error");e(".validation-msg.vp-error").remove();e(".vp-metabox-error").remove();s=vp.fields_validation_loop(t);if(s>0){$notif=e('<span class="vp-metabox-error vp-js-tipsy" original-title="'+s+' error(s) found in metabox"></span>');if(i==="Save Draft"){e("#minor-publishing-actions .spinner, #minor-publishing-actions .ajax-loading").hide();$notif.tipsy();$notif.insertAfter("#minor-publishing-actions .spinner, #minor-publishing-actions .ajax-loading");e("#save-post").prop("disabled",false).removeClass("button-disabled")}else if(i==="Publish"||i==="Update"){e("#publishing-action .spinner, #publishing-action .ajax-loading").hide();$notif.tipsy();$notif.insertAfter("#publishing-action .spinner, #publishing-action .ajax-loading");e("#publish").prop("disabled",false).removeClass("button-primary-disabled")}var o=Math.ceil((r.outerHeight()-$notif.height())/2);if(o>0)$notif.css("margin-top",o);n.preventDefault();return}e(this).find(".vp-toggle .vp-input").each(function(){var t=e("<input>",{type:"hidden",name:this.name,value:0});e(this).before(t)})});e("#post input[type=submit]").click(function(){e("input[type=submit]",e(this).parents("form")).removeAttr("clicked");e(this).attr("clicked","true")});e.wpalchemy.on("wpa_copy",function(e,t){n=[];i=[];r=[];t.find('input[class="tocopy-hidden"]').first().remove();s(t.find(".vp-field"));o(t.find(".vp-meta-group"));t.find(".vp-wpa-group-title:first").click();a(n);f(r);l(i)})})(jQuery)